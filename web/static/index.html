<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ListenTogether</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="versionTag" style="position:fixed;top:4px;left:8px;font-size:11px;color:rgba(255,255,255,0.35);z-index:9999;pointer-events:none;">v0.5.4</div>
    <div id="userBar" class="user-bar hidden">
        <span id="currentUsername"></span>
        <button id="settingsBtn" class="btn-icon" title="è®¾ç½®">âš™ï¸</button>
        <button id="libraryBtn" class="btn-icon hidden" title="éŸ³é¢‘åº“">ğŸ“š</button>
        <button id="adminBtn" class="btn-icon hidden" title="ç”¨æˆ·ç®¡ç†">ğŸ‘¥</button>
        <button id="logoutBtn" class="btn-icon" title="ç™»å‡º">ğŸšª</button>
    </div>

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen">
            <div class="logo">
                <span class="icon">ğŸµ</span>
                <h1>ListenTogether</h1>
                <p class="tagline">Sync music with friends</p>
            </div>
            <div class="auth-box">
                <div class="auth-tabs">
                    <button id="loginTab" class="auth-tab active">ç™»å½•</button>
                    <button id="registerTab" class="auth-tab">æ³¨å†Œ</button>
                </div>
                <div id="loginForm">
                    <input type="text" id="loginUsername" placeholder="ç”¨æˆ·å" autocomplete="username">
                    <input type="password" id="loginPassword" placeholder="å¯†ç " autocomplete="current-password">
                    <button id="loginSubmit" class="btn primary">ç™»å½•</button>
                </div>
                <div id="registerForm" class="hidden">
                    <input type="text" id="regUsername" placeholder="ç”¨æˆ·åï¼ˆ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰" autocomplete="username">
                    <input type="password" id="regPassword" placeholder="å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" autocomplete="new-password">
                    <input type="password" id="regPassword2" placeholder="ç¡®è®¤å¯†ç " autocomplete="new-password">
                    <button id="registerSubmit" class="btn primary">æ³¨å†Œ</button>
                </div>
                <div id="authError" class="auth-error"></div>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="home" class="screen">
            <div class="logo">
                <span class="icon">ğŸµ</span>
                <h1>ListenTogether</h1>
                <p class="tagline">Sync music with friends</p>
            </div>
            <div class="actions">
                <button id="createBtn" class="btn primary">Create Room</button>
                <div id="createDivider" class="divider"><span>or</span></div>
                <div class="join-form">
                    <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="8">
                    <button id="joinBtn" class="btn secondary">Join</button>
                </div>
            </div>
        </div>

        <!-- Room Screen -->
        <div id="room" class="screen">
            <div class="room-header">
                <div class="room-info">
                    <span class="room-code" id="displayCode"></span>
                    <span class="user-count"><span id="userCount">1</span> listening</span>
                </div>
                <button id="copyCode" class="btn-icon" title="Copy room code">ğŸ“‹</button>
                <button id="leaveBtn" class="btn-icon" title="é€€å‡ºæˆ¿é—´" style="margin-left:4px;color:#e74c3c;">âœ•</button>
            </div>

            <div id="avatarBar" class="avatar-bar"></div>

            <div id="audiencePanel" class="audience-panel hidden">
                <div class="audience-header">
                    <span>å¬ä¼—åˆ—è¡¨</span>
                    <button id="audiencePanelClose" class="btn-icon">âœ•</button>
                </div>
                <div id="audienceList" class="audience-list"></div>
                <div class="audience-footer">
                    <button id="copyInviteLink" class="btn primary btn-full">ğŸ“ å¤åˆ¶é‚€è¯·é“¾æ¥</button>
                </div>
            </div>

            <div class="player">
                <div class="track-info">
                    <div class="track-name" id="trackName">No track loaded</div>
                    <div class="sync-status" id="syncStatus">Syncing...</div>
                    <div class="sync-status" id="driftStatus" style="font-size:11px;color:#aaa;"></div>
                    <div id="syncDebug" style="font-size:10px;color:#888;font-family:monospace;line-height:1.4;margin-top:2px;"></div>
                </div>

                <div class="progress-container">
                    <span id="seekTooltip" class="seek-tooltip hidden"></span>
                    <input type="range" id="progressBar" class="progress" min="0" max="100" value="0">
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>

                <div class="controls">
                    <button id="playPauseBtn" class="btn-control play" disabled>â–¶</button>
                </div>

                <div class="volume-control">
                    <span>ğŸ”Š</span>
                    <input type="range" id="volumeSlider" class="volume" min="0" max="100" value="80">
                    <select id="qualitySelector" class="quality-select hidden" title="éŸ³è´¨é€‰æ‹©"></select>
                </div>
            </div>

            <!-- Playlist Panel -->
            <div id="playlistPanel" class="playlist-panel hidden">
                <div class="playlist-header">
                    <span>ğŸ¶ æ’­æ”¾åˆ—è¡¨</span>
                    <div class="playlist-actions">
                        <button id="playModeBtn" class="btn-icon" title="æ’­æ”¾æ¨¡å¼">ğŸ”</button>
                        <button id="addFromLibBtn" class="btn-icon" title="ä»éŸ³é¢‘åº“æ·»åŠ ">â•</button>
                    </div>
                </div>
                <div id="playlistItems" class="playlist-items"></div>
                <div id="playlistEmpty" class="playlist-empty">æ’­æ”¾åˆ—è¡¨ä¸ºç©º</div>
            </div>
        </div>
    </div>

    <!-- Library Modal -->
    <div id="libraryModal" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-header">
                <span>ä»éŸ³é¢‘åº“æ·»åŠ </span>
                <button id="libraryModalClose" class="btn-icon">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="libraryList" class="library-list"></div>
                <div id="libraryEmpty" class="playlist-empty">æ— å¯ç”¨éŸ³é¢‘</div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsOverlay" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-header">
                <span>è´¦å·è®¾ç½®</span>
                <button id="settingsClose" class="btn-icon">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3 class="settings-title">è´¦å·ä¿¡æ¯</h3>
                    <div class="settings-info">
                        <div>UIDï¼š<span id="settingsUID" class="uid-display"></span> <span id="settingsSUID" class="suid-display"></span></div>
                        <div>ç”¨æˆ·åï¼š<span id="settingsUsername"></span></div>
                        <div>è§’è‰²ï¼š<span id="settingsRole"></span></div>
                        <div>æ³¨å†Œæ—¶é—´ï¼š<span id="settingsCreatedAt"></span></div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-title">ä¿®æ”¹ç”¨æˆ·å</h3>
                    <input type="text" id="newUsernameInput" placeholder="æ–°ç”¨æˆ·åï¼ˆ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰">
                    <input type="password" id="usernamePassword" placeholder="å½“å‰å¯†ç ">
                    <div id="usernameError" class="settings-error"></div>
                    <button id="changeUsernameBtn" class="btn primary btn-full">ç¡®è®¤ä¿®æ”¹</button>
                </div>
                <div class="settings-section">
                    <h3 class="settings-title">ä¿®æ”¹å¯†ç </h3>
                    <input type="password" id="oldPwInput" placeholder="æ—§å¯†ç ">
                    <input type="password" id="newPwInput" placeholder="æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
                    <input type="password" id="confirmPwInput" placeholder="ç¡®è®¤æ–°å¯†ç ">
                    <div id="passwordError" class="settings-error"></div>
                    <button id="changePasswordBtn" class="btn primary btn-full">ç¡®è®¤ä¿®æ”¹</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js?v=17"></script>
    <script src="js/cache.js?v=17"></script>
    <script src="js/sync.js?v=17"></script>
    <script src="js/player.js?v=17"></script>
    <script src="js/app.js?v=17"></script>
</body>
</html>
